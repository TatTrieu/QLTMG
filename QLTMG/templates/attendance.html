{% extends 'layout/base.html' %}

{% block header_title %}ĐIỂM DANH HÀNG NGÀY{% endblock %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-body">
        <form method="get" class="row g-3 mb-4">
            <div class="col-md-3">
                <label class="form-label fw-bold">Ngày điểm danh:</label>
                <input type="date" name="date" class="form-control" value="{{ current_date }}" onchange="this.form.submit()">
            </div>

            {% if current_user.role.name == 'ADMIN' %}
            <div class="col-md-3">
                <label class="form-label fw-bold">Chọn lớp:</label>
                <select name="class_id" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Chọn lớp --</option>
                    {% for c in classes %}
                    <option value="{{ c.id }}" {% if current_class_id == c.id|string %}selected{% endif %}>
                        {{ c.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% else %}
                {% if current_class_obj %}
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Lớp:</label>
                        <input type="text" class="form-control" value="{{ current_class_obj.name }}" disabled>
                        <input type="hidden" name="class_id" value="{{ current_class_obj.id }}">
                    </div>
                {% else %}
                    <div class="alert alert-warning">Bạn chưa được phân công lớp chủ nhiệm!</div>
                {% endif %}
            {% endif %}
        </form>

        <hr>

        {% if students %}
        <form action="/attendance/save" method="post">
            <input type="hidden" name="class_id" value="{{ current_class_id }}">
            <input type="hidden" name="date" value="{{ current_date }}">

            <table class="table table-bordered table-hover align-middle">
                <thead class="table-primary text-center">
                    <tr>
                        <th>STT</th>
                        <th>Họ tên</th>
                        <th>Trạng thái</th>
                        <th>Ghi chú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in students %}
                    <tr>
                        <td class="text-center">{{ loop.index }}</td>
                        <td class="fw-bold">{{ item.student.name }}</td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <input type="radio" class="btn-check" name="status_{{ item.student.id }}" id="s1_{{ item.student.id }}" value="1" {% if item.status == 1 %}checked{% endif %}>
                                <label class="btn btn-outline-success" for="s1_{{ item.student.id }}">Có mặt</label>

                                <input type="radio" class="btn-check" name="status_{{ item.student.id }}" id="s2_{{ item.student.id }}" value="-1" {% if item.status == -1 %}checked{% endif %}>
                                <label class="btn btn-outline-warning" for="s2_{{ item.student.id }}">Có phép</label>

                                <input type="radio" class="btn-check" name="status_{{ item.student.id }}" id="s3_{{ item.student.id }}" value="0" {% if item.status == 0 %}checked{% endif %}>
                                <label class="btn btn-outline-danger" for="s3_{{ item.student.id }}">Vắng</label>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control form-control-sm" name="note_{{ item.student.id }}" value="{{ item.note }}" placeholder="Lý do...">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="text-end mt-3">
                <button type="submit" class="btn btn-primary px-4">
                    <i class="fa-solid fa-floppy-disk"></i> Lưu Điểm Danh
                </button>
            </div>
        </form>
        {% else %}
            <p class="text-center text-muted fst-italic mt-5">Vui lòng chọn Lớp để bắt đầu điểm danh.</p>
        {% endif %}
    </div>
</div>
{% endblock %}